---
title: 正则表达式
date: 2017-01-01 09:00:00
tags: [RegEx]
---

# 特殊字符（元字符）

元字符具有特殊含义，若要匹配元字符的字面值，须用 `\` 转义。

## 逻辑

- `\`: 将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。
- `|`: 指明两项之间的一个选择。

## 位置

- `^`: 行的开始处，除非在方括号表达式中使用，此时它表示不接受该字符集合。若设置了 RegExp 对象的 Multiline 属性，则也匹配换行符之后的内容。
- `$`: 行的结尾处。如果设置了 RegExp 对象的 Multiline 属性，则也匹配换行符之前的内容。
- `\b`: 匹配一个单词边界，也就是指单词和空格间的位置。例如， `er\b` 可以匹配"never"中的"er"，但不能匹配"verb"中的"er"。
- `\B`: 匹配非单词边界。`er\B` 能匹配"verb"中的"er"，但不能匹配"never"中的"er"。

## 限制符

- `?`：
  - 匹配前面的子表达式零次或一次。
  - 跟在数量限制符后面时表示非贪婪匹配，即尽可能少地匹配字符。
- `+`: 匹配前面的子表达式一次或多次。
- `*`: 匹配前面的子表达式零次或多次。
- `{`: 标记限定符表达式的开始。
  - `{n}`: n 次。
  - `{n,}`: 至少 n 次。
  - `{n,m}`: 至少 n 次，至多 m 次。

## 符号

- `.`: 匹配除换行符 '\n' 之外的任何单字符。使用 `[.\n]` 来包含 `\n`。
- `\cx`: 匹配由 x 指明的控制字符。例如， `\cM` 匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 `c` 视为一个原义的 'c' 字符。
- `\d`: 匹配一个数字字符。等价于 `[0-9]`。
- `\D`: 匹配一个非数字字符。等价于 `[^0-9]`。
- `\f`: 匹配一个换页符。等价于 `\x0c` 和 `\cL`。
- `\n`: 匹配一个换行符。等价于 `\x0a` 和 `\cJ`。
- `\r`: 匹配一个回车符。等价于 `\x0d` 和 `\cM`。
- `\s`: 匹配任何空白字符，包括空格、制表符、换页符等等。等价于 `[ \f\n\r\t\v]`。
- `\S`: 匹配任何非空白字符。等价于 `[^ \f\n\r\t\v]`。
- `\t`: 匹配一个制表符。等价于 `\x09` 和 `\cI`。
- `\v`: 匹配一个垂直制表符。等价于 `\x0b` 和 `\cK`。
- `\w`: 匹配包括下划线的任何单词字符。等价于 `[A-Za-z0-9_]`。
- `\W`: 匹配任何非单词字符。等价于 `[^A-Za-z0-9_]`。
- `\xn`: 匹配 n，其中 n 为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，`\x41` 匹配 "A"。`\x041` 则等价于 '\x04' & "1"。正则表达式中可以使用 ASCII 编码。
- `\{num}`: 匹配 num，其中 num 是一个正整数。对所获取的匹配的引用。例如，`(.)\1` 匹配两个连续的相同字符。
- `\n`: 标识一个八进制转义值或一个向后引用。如果 `\n` 之前至少 n 个获取的子表达式，则 n 为向后引用。否则，如果 n 为八进制数字 (0-7)，则 n 为一个八进制转义值。
- `\nm`: 标识一个八进制转义值或一个向后引用。如果 `\nm` 之前至少有 nm 个获得子表达式，则 nm 为向后引用。如果 `\nm` 之前至少有 n 个获取，则 n 为一个后跟文字 m 的向后引用。如果前面的条件都不满足，若 n 和 m 均为八进制数字 (0-7)，则 `\nm` 将匹配八进制转义值 nm。
- `\nml`: 如果 n 为八进制数字 (0-3)，且 m 和 l 均为八进制数字 (0-7)，则匹配八进制转义值 nml。
- `\un`: 匹配 n，其中 n 是一个用四个十六进制数字表示的 Unicode 字符。例如， `\u00A9` 匹配版权符号。

## 集合

- `()`: 标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。
- `[xyz]`: 字符集合。匹配所包含的任意一个字符。例如， `[abc]` 可以匹配 "plain" 中的 'a'。
- `[^xyz]`: 负值字符集合。匹配未包含的任意字符。例如， `[^abc]` 可以匹配 "plain" 中的'p'、'l'、'i'、'n'。
- `[a-z]`: 字符范围。匹配指定范围内的任意字符。例如，`[a-z]` 可以匹配 'a' 到 'z' 范围内的任意小写字母字符。
- `[^a-z]`: 负值字符范围。匹配任何不在指定范围内的任意字符。例如，`[^a-z]` 可以匹配任何不在 'a' 到 'z' 范围内的任意字符。

## 大小写转换

只在部分正则实现中可用。

- `\L`: 把 `\L` 和 `\E` 之间的字符全部转为小写。
- `\U`: 把 `\U` 和 `\E` 之间的字符全部转为大写。
- `\E`: 结束 `\L` 或 `\U` 转换。
- `\l`: 把下一个字符转为小写。
- `\u`: 把下一个字符转为大写。

# 环视

向前查找和向后查找本身是有返回结果的，只是字节长度固定为 0，所以又称零宽（zero-width）操作。

- `(?:pattern)`: 匹配 pattern 但不获取匹配结果，不会暂存供以后使用。通常跟 `\|` 配合使用。例如， `industr(?:y\|ies)` 就是一个比 `industry\|industries` 更简略的表达式。
- `(?=pattern)`: （正）向前查找。在匹配 pattern 的地方向前查找字符串。
  - 非获取匹配。
  - 不消耗字符。也就是说，在一个匹配发生后，下次搜索从 pattern 开始，而不是从它之后开始。
- `(?<=pattern)`: （正）向后查找。在匹配 pattern 的地方向后查找字符串。其余同“向前查找”。
- `(?!pattern)`: （负）向前查找，在**不**匹配 pattern 的地方向前查找字符串。
  - 非获取匹配。
  - 不消耗字符，也就是说，在一个匹配发生后，下次搜索从 pattern 开始，而不是从它之后开始。
- `(?<!pattern)`: （负）向后查找。在**不**匹配 pattern 的地方向后查找字符串。其余同“向前查找”。
- `(?>pattern)`: 固化分组。当该分组内的pattern匹配成功后，引擎进行对整个字符串进行回溯时不会对固化分组的内容进行回溯。换句话说，当固化分组中的pattern匹配成功后，它所有的备份状态都会被放弃，故不能被回溯。


# 条件判断

## 回溯引用条件

`(?(ref)true-exp|false-exp)`

- `ref`: 一个回溯引用，不用写 `\`。
- `true-exp`: 若回溯引用存在的话就匹配此模式。
- `false-exp`: 若回溯引用不存在的话就匹配此模式。可选。

## 前后查找条件

`(?(?=exp)true-exp|false-exp)`

- `(?=exp)` 环视条件，可换成其他类型的环视。
- `true-exp`: 若环视条件满足的话就匹配此模式。
- `false-exp`: 若环视条件不满足的话就匹配此模式。可选。

# 运算符优先级

正则表达式从左到右进行计算，并遵循优先级顺序。

相同优先级的从左到右进行运算，不同优先级的运算先高后低。以下列表从最高到最低说明了各种正则表达式运算符的优先级顺序：

1. `\`: 转义符
2. `()`, `(?:)`, `(?=)`, `[]`: 圆括号和方括号
3. `*`, `+`, `?`, `{n}`, `{n,}`, `{n,m}`: 限定符
4. `^`, `$`, 任何元字符、任何字符: 定位点和序列（即：位置和顺序）
5. `|`: 替换，"或"操作

字符具有高于替换运算符的优先级，使得 `m|food` 匹配"m"或"food"。若要匹配"mood"或"food"，请使用括号创建子表达式，从而产生 `(m|f)ood`。

# 常用表达式

`(<(\d)>[^<]*<)(?!\2)(?(1)[^<]*>)` 前后名称不一致的标签（标签名要根据实际情况修改一下）。

